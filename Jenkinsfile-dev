pipeline {
    agent any

    stages {
         stage('Clone repository') { 
            steps { 
                script{
                checkout scm
                dir('hello'){
                    git branch: 'development',
                    credentialsId: 'alfredbigger',
                    url: 'https://github.com/kocakkadir/spring-boot-hello-world.git'
                }
                sh 'pwd'
                sh 'ls'
                }
            }
        }

        stage('Build') { 
            steps { 
                script{
                 app = docker.build("660961155995.dkr.ecr.us-west-2.amazonaws.com/hello-dev")
                }
            }
        }
        stage('Image Push') {
            steps {
                script{
                        docker.withRegistry('https://660961155995.dkr.ecr.us-west-2.amazonaws.com', 'ecr:us-west-2:aws-id') {
                    app.push("1.0.0")
                    }
                }
            }
        }
 /*       stage('Deploy') {
            steps {
                script{
                    sh '''
                        TAG=$(cd $projectName && git tag --list '[0-9]*\\.[0-9]*\\.[0-9]*' --sort=-version:refname | head -n1)
                        echo "this is dev-build-job, will be tagged $TAG"
                        aws eks --region us-west-2 update-kubeconfig --name biggergames-dev-cluster
                        aws secretsmanager get-secret-value --secret-id $projectName-dev-env --region us-west-2 --query SecretString --output text > ./$projectName-dev-env-configmap.yaml
                        pwd
                        ls
                        helm upgrade --install --values $projectName/helm/helm/dev/$projectName-values.yaml  --set-file configValues=./$projectName-dev-env-configmap.yaml --create-namespace --namespace application --set deploy.tag=${TAG} $projectName-dev $projectName/helm/helm
                    '''
                }
            }
        }
     */   
    }
}
